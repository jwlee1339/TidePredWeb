# 潮汐預報與分析工具 (Tide Prediction and Analysis Tool)

這是一個基於網頁的潮汐預報與分析工具，它使用調和分析法 (Harmonic Analysis) 來預測指定年份的潮位，並可將預測結果與實際觀測資料進行視覺化比較與分析。

## 專案目的

本專案旨在提供一個易於使用的介面，讓使用者能夠：

1. 根據已知的潮汐調和參數，快速產生未來任一年份的逐時潮位預報。
2. 將預報結果與觀測資料進行比對，評估預測的準確性。
3. 以視覺化圖表和數據摘要的形式，深入了解特定測站的潮汐特性。

此工具最初由 C# 版本改寫為 Python 腳本，再進一步轉換為可直接在瀏覽器中運行的 JavaScript 版本，方便使用者在沒有 Python 環境的情況下也能使用。

## 主要功能

- **網頁化操作介面**：透過 `index.html` 提供所有功能，無需安裝額外軟體。
- **潮汐預報**：上傳調和參數檔案，即可產生指定年份的逐時潮位預報。
- **年度報告輸出**：產生格式化的年度潮汐預報報告 (`.txt` 格式)，詳列每日每小時的預測潮位。
- **觀測資料比對**：可上傳觀測資料 (`.csv` 格式)，與預測結果在同一圖表中進行比較。
- **數據統計與分析**：
    - 自動計算預測值與觀測值之間的均方根誤差 (RMSE)。
    - 動態顯示圖表可視範圍內的最高潮位、最低潮位、平均潮位、最大漲潮差與最大落潮差。
    - 比較預測與觀測在各項統計數據上的差異。
- **互動式圖表**：
    - 使用 Chart.js 繪製，支援滑鼠滾輪縮放與拖曳平移。
    - 提供按鈕進行快速平移、重設縮放及下載圖表 (PNG 格式)。
- **一鍵範例分析**：內建範例資料，讓使用者可以快速了解工具的完整功能。
- **獨立 Python 腳本**：專案中也包含 `tide_pred.py`，可獨立在命令列環境下執行所有分析與報告產製功能。

## 運作原理

本工具的核心預測模型基於**潮汐調和分析法**。此方法將複雜的潮汐現象分解為一系列具有不同週期、振幅和相位的正弦波（稱為分潮，Harmonic Constituents），例如 M2、S2、K1、O1 等。

特定時間點 `t` 的潮位 `h(t)` 可以透過以下公式加總計算得出：

`h(t) = h₀ + Σ [ Cⱼ * cos(2πt/Tⱼ) + Sⱼ * sin(2πt/Tⱼ) ]`

其中：
- `h₀` 是平均海平面高度。
- `j` 代表每一個分潮。
- `Cⱼ` 和 `Sⱼ` 是該分潮的調和常數，由歷史觀測資料分析得出。
- `Tⱼ` 是該分潮的週期。

本工具讀取包含這些參數的檔案，並依此公式計算出指定時間的潮位。

## 輸入資料格式

1. **調和參數檔案 (`.txt`)**

    檔案需包含觀測年份、分潮數量、平均潮位以及各分潮的參數表格。格式範例如下：

    ```plain
    * Observed Year
    2010
    *
    * 分潮數     平均潮位(CM)
       25         150.0
    *
    * 分潮    週期(HOURS)   振幅(CM)  相位角(rad)    Cj(CM) Sj(CM)
    M2      12.4206      50.0      1.5708         0.0      50.0
    S2      12.0000      25.0      0.0            25.0     0.0
    ...
    ```

2. **觀測資料檔案 (`.csv`, 可選)**

    若要進行比較，需提供包含觀測時間和潮位值的 CSV 檔案。檔案必須包含 `initTime` 和 `value` 兩個欄位。

    ```csv
    initTime,value
    2024-01-01 00:00:00,0.56
    2024-01-01 01:00:00,0.45
    ...
    ```

## 使用方法

### 方法一：使用網頁介面 (建議)

1. 用瀏覽器開啟 `index.html` 檔案。
2. 點擊「選擇檔案」按鈕，上傳您的調和參數檔案 (`.txt`)。
3. 在「輸入西元年份」欄位中，填寫您想預測的年份。
4. (可選) 若要進行比較，請上傳觀測資料檔案 (`.csv`)。
5. (可選) 修改測站名稱與代碼。
6. 選擇您需要的輸出項目（僅報告、僅圖表、或兩者皆要）。
7. 點擊 **`產生報告`** 按鈕。
8. 結果將會顯示在下方，您可以下載報告或操作圖表。

> **快速體驗**：直接點擊 **`使用範例資料一鍵分析`** 按鈕，即可載入內建的範例資料並查看完整的分析結果。

### 方法二：使用 Python 腳本

您也可以在終端機或命令提示字元中直接執行 Python 腳本。

1. **基本預報與報告產製**
    ```bash
    python tide_pred.py <參數檔案路徑> <預測年份>
    ```
    範例：
    ```bash
    python tide_pred.py parameters/HarmonicParams_2024.txt 2024 --output_dir reports
    ```

2. **進行比較並繪圖**
    ```bash
    python tide_pred.py <參數檔> <年份> --compare --obs_file <觀測檔> --plot
    ```
    範例：
    ```bash
    python tide_pred.py parameters/HarmonicParams_2024.txt 2024 --compare --obs_file data/y2024Tide.csv --plot --output_dir reports
    ```

## 技術棧

- **前端**: HTML, CSS, JavaScript, Bootstrap 5
- **圖表**: Chart.js (with `chartjs-plugin-zoom` and `chartjs-adapter-date-fns`)
- **核心邏輯**: JavaScript (Web), Python 3 (Script)

## 推送至 GitHub

若要將本地專案推送到新的 GitHub 儲存庫，可參考以下指令。

1.  在 GitHub.com 上建立一個新的、空的儲存庫。
2.  在終端機中，進入本地專案的根目錄。
3.  執行以下指令 (請將 URL 替換成您自己的儲存庫 URL):

    ```bash
    # (如果尚未初始化) git init && git add . && git commit -m "Initial commit"
    
    git remote add origin https://github.com/您的使用者名稱/您的儲存庫名稱.git
    git branch -M main
    git push -u origin main
    ```